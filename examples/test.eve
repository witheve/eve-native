Get the auth

disabled
search
  [#html/event/click element: [#login]]
  client-id = "3354b6a98e3c4fb3b804c5a9e064a3df"
  response-type = "code"
  redirect-uri = string/url-encode[text: "http://localhost:8081/#spotify-callback"]
  address = "https://accounts.spotify.com/authorize/?client_id={{client-id}}&response_type={{response-type}}&redirect_uri={{redirect-uri}}&scope=user-read-private%20user-read-email&state=34fFs29kd09"
commit
  [#html/redirect #req url: address]
end

Display a button to login

disabled
search
  not([#logged-in])
bind
  [#ui/button #login text: "Login to Spotify"]
end

When a code is received, the user is logged in

disabled
search
  [#html/event/page-show url: [#html/url query: [key: "code" value index]]]
commit
  [#ui/text text: "Logged in"]
  [#logged-in]
end

search
  //address = "https://accounts.spotify.com/api/token?grant_type={{grant-type}}&code={{code}}&redirec_uri={{redirect-uri}}"
  //encoded-authorization = string/encode[text: "3354b6a98e3c4fb3b804c5a9e064a3df:b431c961f8d1457a91e0b90857bc8fa0"]
  //grant-type = []
commit
  //[#http/request #goog address: "http://echo.jsontest.com/key/shenberger/one/manifold" method: "GET"]
  //[#http/request address: "https://accounts.spotify.com/authorize/" headers: [#http/header key: "Authorization" value: "Basic {{encoded-authorization}}"]]
end

search
  (address, text) = if [#http/request address response] then (address, response.body)
                    else if [#http/request address error] then (address, error.error)
commit
  [#html/div text: "{{address}} {{text}}"]
end

disabled
search
  [#req response: [#http/response status body]]
commit
  [#json/decode #qq json: body]
end


disabled
search
  [#qq json-object: [one key]]
commit
  [#console/log text: "{{one}} {{key}}"]
end



disabled
commit
  [#http/server address: "127.0.0.1:8080"]
end



search
  encoded-string = string/url-encode[text: "http://localhost:8081/#spotify-callback"]
commit
  [#ui/text text: encoded-string]
end